
# **Лабораторная работа №1. Основы запросов, индексов и анализа производительности в PostgreSQL**

## **Цель работы**

Освоить:

* создание таблиц и заполнение данными;
* выполнение запросов с фильтрами, группировками и агрегатами;
* анализ выполнения запросов с помощью EXPLAIN;
* создание индексов и анализ статистики;
* изучение системных таблиц PostgreSQL.

---

# **Задание**

## **Шаг 1. Создать таблицу**

Студент должен самостоятельно создать таблицу с полями:

* идентификатор (первичный ключ),
* имя покупателя,
* название товара,
* количество,
* цена,
* дата продажи.

---

## **Шаг 2. Заполнить таблицу**

Добавить 15–20 строк с произвольными продажами разных товаров и клиентов.

---

## **Шаг 3. Выполнить базовые запросы**

### **3.1. Фильтрация**

Выполнить запросы:

* найти все продажи определённого товара;
* найти продажи дороже определённой суммы;
* выбрать продажи за указанный диапазон дат.

### **3.2. Группировка и агрегаты**

Студент должен написать запросы:

* суммарная выручка;
* средняя цена по каждому товару;
* количество продаж по каждому клиенту;
* максимальная цена среди всех продаж.

---

## **Шаг 4. Анализ выполнения запросов (EXPLAIN)**

Студент выполняет команду EXPLAIN для одного из запросов (например, по фильтрации товара) и отвечает на вопросы:

1. Почему используется последовательное сканирование?
2. Что означают значения в оценке стоимости выполнения?
3. Как PostgreSQL выбирает стратегию выполнения запроса?

---

## **Шаг 5. Создание индекса**

Студент должен создать индекс на одном из текстовых полей (например, поле товара) и повторить EXPLAIN для того же запроса.

После этого в отчёте сравнить:

* план выполнения до индекса,
* план после индекса,
* было ли использовано индексное сканирование.

---

## **Шаг 6. Анализ использования индекса**

Студент должен найти статистику по созданному индексу через системные таблицы PostgreSQL:

* количество обращений к индексу,
* был ли он использован сервером,
* общее число сканирований.

---

## **Шаг 7. Изучение системных таблиц PostgreSQL**

Студент должен выполнить запросы, которые позволяют:

* получить список всех таблиц в схеме public;
* посмотреть структуру созданной таблицы через системные каталоги;
* узнать размер таблицы;
* получить информацию о всех индексах в схеме.

### **7.1. Посмотреть все таблицы в схеме public**

```sql
SELECT tablename 
FROM pg_tables 
WHERE schemaname = 'public';
```

---

### **7.2. Узнать структуру своей таблицы через системный каталог**

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name = 'sales';
```

---

### **7.3. Посмотреть размер таблицы**

```sql
SELECT pg_size_pretty(pg_total_relation_size('sales'));
```

---

### **7.4. Посмотреть все индексы вашей схемы**

```sql
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE schemaname = 'public';
```

---

# **Контрольные вопросы**

1. Что такое план выполнения запроса?
2. Чем отличается последовательное сканирование от индексного?
3. В каких случаях индекс улучшает производительность, а в каких — нет?
4. Какие системные таблицы PostgreSQL отвечают за хранение информации о структурах данных?
5. Как определить, использовался ли индекс фактически?

---
